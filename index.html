<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Servicio de las Tecnologías de la Información y las Comunicaciones - Universidad de Almería">
<title>Introducción a NestJS</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Introducción a NestJS</h1>
<div class="details">
<span id="author" class="author">Servicio de las Tecnologías de la Información y las Comunicaciones - Universidad de Almería</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de contenidos</div>
<ul class="sectlevel1">
<li><a href="#trueresumen">Resumen</a></li>
<li><a href="#truec-digos-de-error">1. Códigos de error</a></li>
<li><a href="#truetodo">2. ToDo</a>
<ul class="sectlevel2">
<li><a href="#trueimplementaci-n-de-servicios-con-bases-de-datos">2.1. Implementación de servicios con bases de datos</a></li>
<li><a href="#truec-digos-de-error-y-control-de-errores">2.2. Códigos de error y control de errores</a></li>
<li><a href="#truelogging">2.3. Logging</a></li>
</ul>
</li>
<li><a href="#truecreaci-n-de-proyecto">3. Creación de proyecto</a>
<ul class="sectlevel2">
<li><a href="#truefuncionamiento-servicios-y-controladores">3.1. Funcionamiento (Servicios y Controladores)</a></li>
<li><a href="#truedefinir-un-prefijo-para-la-api">3.2. Definir un prefijo para la API.</a></li>
</ul>
</li>
<li><a href="#truecreaci-n-de-nuestro-primer-servicio-y-controlador">4. Creación de nuestro primer servicio y controlador</a>
<ul class="sectlevel2">
<li><a href="#trueel-servicio">4.1. El servicio</a></li>
<li><a href="#trueel-controlador">4.2. El controlador</a></li>
</ul>
</li>
<li><a href="#truecreaci-n-de-la-primera-versi-n-de-los-endpoints">5. Creación de la primera versión de los endpoints</a>
<ul class="sectlevel2">
<li><a href="#truerecuperaci-n-de-un-libro">5.1. Recuperación de un libro</a></li>
<li><a href="#truefiltrado-mediante-par-metros-recuperaci-n-de-todos-los-libros-en-orden-descendente">5.2. Filtrado mediante parámetros. Recuperación de todos los libros en orden descendente.</a></li>
<li><a href="#truecreaci-n-de-un-libro">5.3. Creación de un libro</a></li>
<li><a href="#trueeliminaci-n-de-un-libro">5.4. Eliminación de un libro</a></li>
<li><a href="#truemodificaci-n-de-un-libro">5.5. Modificación de un libro</a></li>
</ul>
</li>
<li><a href="#truetipado-de-objetos">6. Tipado de objetos</a>
<ul class="sectlevel2">
<li><a href="#truecreaci-n-de-una-interface-para-libros">6.1. Creación de una interface para libros</a></li>
<li><a href="#truecreaci-n-de-un-dto-para-libros">6.2. Creación de un DTO para libros</a></li>
<li><a href="#truemodificaci-n-del-controlador-para-el-uso-de-tipos">6.3. Modificación del controlador para el uso de tipos</a></li>
<li><a href="#truemodificaci-n-del-servicio-para-el-uso-de-tipos">6.4. Modificación del servicio para el uso de tipos</a></li>
</ul>
</li>
<li><a href="#truefinalizaci-n-del-mockeado">7. Finalización del mockeado</a>
<ul class="sectlevel2">
<li><a href="#trueel-servicio-7">7.1. El servicio</a></li>
<li><a href="#trueel-controlador-7">7.2. El controlador</a></li>
</ul>
</li>
<li><a href="#truedocumentaci-n-de-la-api-con-swagger-openapi">8. Documentación de la API con Swagger (OpenAPI)</a>
<ul class="sectlevel2">
<li><a href="#truedocumentaci-n-de-los-dto">8.1. Documentación de los DTO</a></li>
<li><a href="#truedocumentaci-n-de-los-controladores">8.2. Documentación de los controladores</a></li>
</ul>
</li>
<li><a href="#truedocumentaci-n-del-c-digo">9. Documentación del código</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/logocloudstic.png" alt="logocloudstic.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueresumen"><a class="anchor" href="#trueresumen"></a>Resumen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NestJS es un framework para el desearrollo de aplicaciones Node.js en el lado del servidor. Se programa en JavaScript y proporciona una arquitectura en la aplicación que permite el desarrollo de aplicaciones más fáciles de mantener. Su arquitectura está bastante inspirada en Angular lo que facilita el trabajo al equipo de desarrollo no tener que usar dos formas diferentes de trabajo en el backend y en el frontend.</p>
</div>
<div class="ulist">
<div class="title">Objetivos</div>
<ul>
<li>
<p>Conocer el funcionamiento de los controladores y los servicios</p>
</li>
<li>
<p>Usar el CLI de Nest para la creación de componentes de la aplicación</p>
</li>
<li>
<p>Crear los métodos básicos CRUD de una aplicación</p>
</li>
<li>
<p>Saber cómo capturar los parámetros de las peticiones HTTP</p>
</li>
<li>
<p>Conocer las diferencias y utilidades de las <em>entities</em> de los ORM (Object Relational Mappers), las interfaces y los DTO (Data Transfer Objects)</p>
</li>
<li>
<p>Crear una API sencilla con datos mockeados</p>
</li>
<li>
<p>Crear servicios basados en bases de datos</p>
</li>
<li>
<p>Usar Swagger para la documentación de la API</p>
</li>
<li>
<p>Usar Compodoc para la documentación de la aplicación</p>
</li>
<li>
<p>Registrar las operaciones de la aplicación en archivos de log</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Disponible el <a href="https://github.com/ualmtorres/tutorial-nest-js">repositorio</a> usado en este tutorial.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Trabajo preliminar. Tutorial en fase de elaboración.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truec-digos-de-error"><a class="anchor" href="#truec-digos-de-error"></a>1. Códigos de error</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Mover esto a un anexo y ampliar</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>A successful DELETE, with no further information. 204 No Content</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>A successful DELETE, but you have a warning about related orphan resources that should be deleted too. 200 OK.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>You accepted the DELETE request, but it might take a long time and you're going to do it asynchronously. The client should check it later. 202 Accepted.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>You accepted the DELETE request, but the resource can't be removed and the URI is instead reset to a default. 205 Reset Content.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truetodo"><a class="anchor" href="#truetodo"></a>2. ToDo</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueimplementaci-n-de-servicios-con-bases-de-datos"><a class="anchor" href="#trueimplementaci-n-de-servicios-con-bases-de-datos"></a>2.1. Implementación de servicios con bases de datos</h3>

</div>
<div class="sect2">
<h3 id="truec-digos-de-error-y-control-de-errores"><a class="anchor" href="#truec-digos-de-error-y-control-de-errores"></a>2.2. Códigos de error y control de errores</h3>

</div>
<div class="sect2">
<h3 id="truelogging"><a class="anchor" href="#truelogging"></a>2.3. Logging</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-proyecto"><a class="anchor" href="#truecreaci-n-de-proyecto"></a>3. Creación de proyecto</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ nest new tutorial-nest-js
$ cd tutorial-nest-js
$ npm run start:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto crea un proyecto y lo ejecuta en el puerto 3000 en modo <em>live reload</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/HelloWorld.png" alt="HelloWorld.png">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Se puede cambiar el puerto en el que se sirve la aplicación modificando el archivo <code>main.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">  await app.listen(3000); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cambiar por el puerto deseado</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="truefuncionamiento-servicios-y-controladores"><a class="anchor" href="#truefuncionamiento-servicios-y-controladores"></a>3.1. Funcionamiento (Servicios y Controladores)</h3>
<div class="paragraph">
<p>Los servicios se encargan de abstraer la complejidad y la lógica del negocio a una clase aparte. El CLI de NestJS añade el decorador <code>@Injectable</code> a los servicios durante su creación. Estos servicios se podrán inyectar en controladores o en otros servicios.</p>
</div>
<div class="paragraph">
<p>Archivo <code>app.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Injectable } from '@nestjs/common';

@Injectable() <i class="conum" data-value="1"></i><b>(1)</b>
export class AppService {
  getHello(): string { <i class="conum" data-value="2"></i><b>(2)</b>
    return 'Hello World!';
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Decorador que permite que el servicio pueda ser inyectado en controladores y en otros servicios</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Función que proporciona una funcionalidad determinada</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El controlador se encarga por un lado de escuchar las peticiones que llegan a la aplicación. Por otro lado, se encarga de preparar las respuestas que proporciona la aplicación. El CLI de NestJS añade el decorador <code>@Controller</code> a los controladores durante su creación. NestJS permite el uso de rutas como parámetros del decorador <code>@Controller</code></p>
</div>
<div class="paragraph">
<p>Archivo <code>app.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service'; <i class="conum" data-value="1"></i><b>(1)</b>

@Controller() <i class="conum" data-value="2"></i><b>(2)</b>
export class AppController {
  constructor(private readonly appService: AppService) {} <i class="conum" data-value="3"></i><b>(3)</b>

  @Get() <i class="conum" data-value="4"></i><b>(4)</b>
  getHello(): string { <i class="conum" data-value="5"></i><b>(5)</b>
    return this.appService.getHello(); <i class="conum" data-value="6"></i><b>(6)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Importación del servicio</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Decorador que indica a NestJS que es un controlador</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inyección del servicio</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Tipo de petición HTTP y ruta (vacía) atendida por el controlador</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Función a ejecutar al tras invocar la ruta con una petición <code>GET</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Invocación al servicio que resuelve la petición</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truedefinir-un-prefijo-para-la-api"><a class="anchor" href="#truedefinir-un-prefijo-para-la-api"></a>3.2. Definir un prefijo para la API.</h3>
<div class="paragraph">
<p>Archivo <code>main.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.setGlobalPrefix('api/v1'); <i class="conum" data-value="1"></i><b>(1)</b>
  await app.listen(3000);
}
bootstrap();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prefijo global</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La aplicación ahora deberá ser llamada incluyendo el prefijo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">http://localhost:3000/api/v1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si no incluimos el prefijo y seguimos invocando a <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code> obtenendremos el siguiente error. Este error indica que la aplicación no tiene nada que respponda en esa ruta a ese tipo de petición HTTP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
  "statusCode": 404,
  "message": "Cannot GET /",
  "error": "Not Found"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-nuestro-primer-servicio-y-controlador"><a class="anchor" href="#truecreaci-n-de-nuestro-primer-servicio-y-controlador"></a>4. Creación de nuestro primer servicio y controlador</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Desde la línea de comandos usaremos el CLI de NestJS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ nest g service books
$ nest g controller books</code></pre>
</div>
</div>
<div class="paragraph">
<p>El servicio creado está disponible en <code>books/books.service.ts</code> y el controlador creado está disponible en <code>books.controller.ts</code>. Los archivos <code>.spec.ts</code> son archivos para pruebas que no trataremos aquí.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El CLI de NestJS ha generado el archivo del servicio <code>books/books.service.ts</code> con el decorador <code>@Injectable</code> y el archivo del controlador <code>books.controller.ts</code> con el decorador <code>@Controller</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La creación del servicio y del controlador han modificado el archivo <code>app.module.ts</code> incorporándolos a la lista de servicios y controladores de la aplicación.</p>
</div>
<div class="paragraph">
<p>El archivo <code>app.module.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { BooksService } from './books/books.service';
import { BooksController } from './books/books.controller';

@Module({
  imports: [],
  controllers: [AppController, BooksController], <i class="conum" data-value="1"></i><b>(1)</b>
  providers: [AppService, BooksService], <i class="conum" data-value="2"></i><b>(2)</b>
})
export class AppModule {}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Lista de controladores</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Lista de providers</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los <em>providers</em> son un concepto de un nivel de abstracción mayor al de los servicios. Cuando decíamos que los servicios se encargaban de abstraer la complejidad y la lógica del negocio a una clase aparte, realmente se debía a que esta abstracción es propia de los <em>providers</em>. Al ser un servicio un tipo particular de <em>provider</em> simplemente heredan su comportamiento.</p>
</div>
<div class="paragraph">
<p>Un <em>provider</em> puede ser un servicio, pero también puede ser un repositorio, una factoría o un <em>helper</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="trueel-servicio"><a class="anchor" href="#trueel-servicio"></a>4.1. El servicio</h3>
<div class="paragraph">
<p>Implementamos las funciones que proporcionan los datos.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Es buena práctica comenzar desarrollando todas las funciones que necesitemos ofreciendo inicialmente la funcionalidad de mostrar simplemente que han sido llamadas. Posteriormente, le iremos añadiendo su lógica real de forma progresiva. Esto nos permite tener inicialmente los componentes y las llamadas funcionando e interactuando sin adentrarnos en la complejidad del dominio.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Injectable } from '@nestjs/common';

@Injectable()
export class BooksService {
  findAll(): any { <i class="conum" data-value="1"></i><b>(1)</b>
    return 'findAll funcionando';
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ejemplo de función que se limita a indicar que está funcionando cuando es llamada</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="trueel-controlador"><a class="anchor" href="#trueel-controlador"></a>4.2. El controlador</h3>
<div class="paragraph">
<p>Comenzamos añadiendo simplemente por ahora:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El constructor donde se inyecta el servicio para poder usarlo</p>
</li>
<li>
<p>Creando la primera ruta y el método HTTP asociado que vamos a probar</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Controller, Get } from '@nestjs/common';
import { BooksService } from './books.service'; <i class="conum" data-value="1"></i><b>(1)</b>

@Controller('books')
export class BooksController {
  constructor(private booksService: BooksService) {} <i class="conum" data-value="2"></i><b>(2)</b>

  @Get() <i class="conum" data-value="3"></i><b>(3)</b>
  findAll() { <i class="conum" data-value="4"></i><b>(4)</b>
    return this.booksService.findAll(); <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Importación del servicio que proporciona los datos</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor con el servicio inyectado</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Decorador para indicar la ruta atendida y el método HTTP</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Método asociado a la petición</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Llamada al método del servicio que resuelve la petición</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si ahora llamamos a <code><a href="http://localhost:3000/api/v1/books" class="bare">http://localhost:3000/api/v1/books</a></code>
el controlador interceptará la petición, usará el servicio y obtendremos la respuesta siguiente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/PrimerServicio.png" alt="PrimerServicio.png">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-la-primera-versi-n-de-los-endpoints"><a class="anchor" href="#truecreaci-n-de-la-primera-versi-n-de-los-endpoints"></a>5. Creación de la primera versión de los endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comenzaremos haciendo el <em>armazón (scaffolfding)</em> de los endpoints para todas las rutas permitidas pero en una versión muy preliminar. Los servicios se limitarán a mostrar que han sido llamados y a mostrar los parámetros pasados. Una vez que todos funcionen correctamente podremos sustituirlos por servicios que tengan la respuesta real que exige el problema.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Endpoints</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/v1/books</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtener lista de libros</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/v1/books/{bookId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devuelve información sobre un libro específico</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/v1/books</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crear un libro</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/v1/books/{bookId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eliminar un libro específico</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/api/v1/books/{bookId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modificar un libro específico</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="truerecuperaci-n-de-un-libro"><a class="anchor" href="#truerecuperaci-n-de-un-libro"></a>5.1. Recuperación de un libro</h3>
<div class="sect3">
<h4 id="trueel-servicio-2"><a class="anchor" href="#trueel-servicio-2"></a>5.1.1. El servicio</h4>
<div class="paragraph">
<p>Añadimos la función que implementa el servicio de recuperación de un libro específico. Tomará como argumento el <code>id</code> del libro e inicialmente se limitará a devolver un mensaje con el propio nombre de la función y el <code>id</code> pasado como argumento. Esto permite comprobar que la función ha sido llamada correctamente.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  findBook(bookId: string) {
    return `findBook funcionando con bookId: ${bookId}`;
  }
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-controlador-2"><a class="anchor" href="#trueel-controlador-2"></a>5.1.2. El controlador</h4>
<div class="paragraph">
<p>Añadimos la ruta que implementa la petición. Tomará como parámetro el <code>id</code> del libro (<code>bookId</code>). Usaremos el decorador NestJS <code>@Param</code> para obtener el parámetro de la petición.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Param } from '@nestjs/common';
...
@Controller('books')
export class BooksController {
...
  @Get(':bookId') <i class="conum" data-value="1"></i><b>(1)</b>
  findBook(@Param('bookId') bookId: string) { <i class="conum" data-value="2"></i><b>(2)</b>
    return this.booksService.findBook(bookId); <i class="conum" data-value="3"></i><b>(3)</b>
  }
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>bookId</code> es el nombre que se le da al argumento en la petición</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Método asociado a la petición con referencia al argumento de la petición y variable asociada para el método</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Llamada al método del servicio que resuelve la petición</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Normalmente se usa el mismo nombre para el parámetro HTTP que para la variable que lo maneja en el método. Sin embargo, son dos objetos diferentes. A continuación se muestra con quien empareja cada uno.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">  @Get(':RequestedBookId')
  findBook(@Param('RequestedBookId') methodBookId: string) {
    return this.booksService.findBook(methodBookId);
  }</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si ahora llamamos a <code><a href="http://localhost:3000/api/v1/books/1" class="bare">http://localhost:3000/api/v1/books/1</a></code> el controlador interceptará la petición, asignará <code>1</code> al parámetro <code>bookId</code> y obtendremos la respuesta siguiente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/GetBookV0.png" alt="GetBookV0.png">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truefiltrado-mediante-par-metros-recuperaci-n-de-todos-los-libros-en-orden-descendente"><a class="anchor" href="#truefiltrado-mediante-par-metros-recuperaci-n-de-todos-los-libros-en-orden-descendente"></a>5.2. Filtrado mediante parámetros. Recuperación de todos los libros en orden descendente.</h3>
<div class="paragraph">
<p>En la URL se pueden pasar parámetros en forma de una lista de pares clave valor. Por ejemplo: <code><a href="http://localhost:3000/api/v1/books?sort=1" class="bare">http://localhost:3000/api/v1/books?sort=1</a></code>. Los parámetros son recogidos en NestJS con el decorador <code>@Query()</code></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Nuevo endpoint o sólo parametros</div>
<div class="paragraph">
<p>Puede surgir la duda de si la recuperación de libros de forma ordenada es un nuevo endpoint o se trata de añadir parámetros a un endpoint existente. Es decir, se trata de elegir entre estas dos alternativas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code><a href="http://localhost:3000/api/v1/books/sort/1" class="bare">http://localhost:3000/api/v1/books/sort/1</a></code></p>
</li>
<li>
<p><code><a href="http://localhost:3000/api/v1/books?sort=1" class="bare">http://localhost:3000/api/v1/books?sort=1</a></code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para resolver la duda nos debemos plantear si la estructura de los datos devueltos cambia de un caso a otro o es la misma en los dos casos. Si cambia estaríamos ante un nuevo endpoint. En cambio, si es la misma, estaríamos ante parámetros.</p>
</div>
<div class="paragraph">
<p>En este caso, la ordenación sigue presentando los datos siguiendo la misma estructura. Es decir, sigue siendo una lista de libros igualmente. Lo único es que se presenta ordenada. El servicio tendrá que capturar los parámetros y devolver los datos de acuerdo a la petición realizada.</p>
</div>
<div class="paragraph">
<p>Esta misma solución es aplicable si hay varios parámetros. Por ejemplo, ordenación, limitación de cantidad de resultados, offsets, filtrado por algún campo, etc. En todos estos casos se sigue devolviendo una lista de resultados con la misma estructura (p.e. libros).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La alternativa de uso de parámetros reduce la cantidad de endpoints a tratar y permite que los parámetros sean opcionales.
El servicio tendrá que encargarse de determinar cómo trabajar con los parámetros de la petición.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Como la petición de recuperación de libros de forma ordenada sigue devolviendo una lista de libros con la misma estructura, optamos por implementar esta funcionalidad mediante parámetros, trasladando la lógica de su interptretación al servicio.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-servicio-3"><a class="anchor" href="#trueel-servicio-3"></a>5.2.1. El servicio</h4>
<div class="paragraph">
<p>La versión preliminar del servicio parametrizado modificará el servicio existente de recuperación de libros. La función tomará los argumentos y se limitará a devolver un mensaje con el propio nombre de la función y el argumento (si existe). Esto permite comprobar que la función ha sido llamada correctamente.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  findAll(params): any {
    return params.length &gt; 0
      ? `findAll funcionando con ${params}`
      : 'findAll funcionando';
  }
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-controlador-3"><a class="anchor" href="#trueel-controlador-3"></a>5.2.2. El controlador</h4>
<div class="paragraph">
<p>Modificamos la ruta que implementa la petición. Tomará como parámetro el tipo de ordenación. Usaremos el decorador NestJS @Query para obtener el parámetro de la petición.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Query } from '@nestjs/common';
...
  @Get()
  findAll(@Query('order') order: string) { <i class="conum" data-value="1"></i><b>(1)</b>
    let params = []; <i class="conum" data-value="2"></i><b>(2)</b>

    if (order !== undefined) {
       params.push(`'${order}'`); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    return this.booksService.findAll(params); <i class="conum" data-value="4"></i><b>(4)</b>
  }
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Captura del parámetro <code>order</code> en una variable <code>order</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Array para almacenamiento de parámetros</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Si se ha pasado el parámetro en la petición, se introduce en el array de parámetros</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Llamada al servicio con los parámetros leídos</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="trueuna-soluci-n-m-s-din-mica"><a class="anchor" href="#trueuna-soluci-n-m-s-din-mica"></a>5.2.3. Una solución más dinámica</h4>
<div class="paragraph">
<p>La solución planteada para el uso de parámetros hace que ante nuevos parámetros en las peticiones se tenga que modificar tanto el controlador (añadiendo nuevos decoradores <code>@Query</code> para los nuevos parámetros) como el servicio, que es el que hace uso de ellos.</p>
</div>
<div class="paragraph">
<p>El decorador <code>@Req</code> nos permite acceder a todos los datos de una petición. En nuestro caso estamos interesados en acceder a <code>query</code>. Esta <code>query</code> contiene un JSON con los pares parámetro-valor pasados en la petición. La idea es pasar directamente este JSON al servicio y que sea el servicio en que se encargue de acceder a su contenido y actuar como corresponda.</p>
</div>
<div class="paragraph">
<p>El servicio <code>books/book.service.ts</code> adaptado para un nuevo parámetro (<code>limit</code>) quedaría así.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  findAll(params): any {
    let msg = `findAll funcionando. Parámetros:`;

    if (params.order !== undefined) {
      msg = msg + ` order: ${params.order}`;
    }

    if (params.limit !== undefined) {
      msg = msg + ` limit: ${params.limit}`;
    }

    return msg;
  }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>El controdor <code>books/book.controller.ts</code> ahora quedaría así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Req } from '@nestjs/common';
import { BooksService } from './books.service';
import { Request } from 'express';
...

@Controller('books')
export class BooksController {
  constructor(private booksService: BooksService) {}

  @Get()
  findAll(@Req() request: Request) { <i class="conum" data-value="1"></i><b>(1)</b>
    return this.booksService.findAll(request.query); <i class="conum" data-value="2"></i><b>(2)</b>
  }
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inyección del objeto <code>request</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Llamada al servicio con el JSON con los pares clave-valor de los parámetros de la petición</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si hiciéramos la petición <code><a href="http://localhost:3000/api/v1/books?order=1&amp;limit=10" class="bare">http://localhost:3000/api/v1/books?order=1&amp;limit=10</a></code>, <code>request.query</code> contendría lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{ order: '1', limit: '10' }</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La pantalla siguiente muestra el resultado de realizar la petición con dos parámetros <code>order</code> y <code>limit</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ParametrosDinamicos.png" alt="ParametrosDinamicos.png">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-un-libro"><a class="anchor" href="#truecreaci-n-de-un-libro"></a>5.3. Creación de un libro</h3>
<div class="paragraph">
<p>Los objetos a crear se pasarán en el <code>body</code> de la petición en formato JSON. El cuerpo de la respuesta contedrá el objeto creado.</p>
</div>
<div class="paragraph">
<p>Supongamos que deseamos insertar el libro siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
    "title": "El enigma de la habitación 622",
    "genre": "Ficción contemporánea",
    "description": "Vuelve el «principito de la literatura negra contemporánea, el niño mimado de la industria literaria» (GQ): el nuevo thriller de Joël Dicker es su novela más personal. ",
    "author": "Joël Dicker",
    "publisher": "Alfaguara",
    "pages": 624,
    "image_url": "https://images-na.ssl-images-amazon.com/images/I/41KiZbwOhhL._SX315_BO1,204,203,200_.jpg"
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="trueel-servicio-4"><a class="anchor" href="#trueel-servicio-4"></a>5.3.1. El servicio</h4>
<div class="paragraph">
<p>La versión preliminar del servicio para crear un nuevo libro se limitará a devolver el libro que le llega como parámetro. Esto permite comprobar que la función ha sido llamada correctamente.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  createBook(newBook: any) {
    return newBook;
  }
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-controlador-4"><a class="anchor" href="#trueel-controlador-4"></a>5.3.2. El controlador</h4>
<div class="paragraph">
<p>El decorador @Body nos permite acceder al <code>body</code> enviado en una petición.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import {
  Post,
  Body,
} from '@nestjs/common';
import { BooksService } from './books.service';
...

@Controller('books')
export class BooksController {
  constructor(private booksService: BooksService) {}
...
  @Post() <i class="conum" data-value="1"></i><b>(1)</b>
  createBook(@Body() body) { <i class="conum" data-value="2"></i><b>(2)</b>
    let newBook: any = body; <i class="conum" data-value="3"></i><b>(3)</b>
    return this.booksService.createBook(newBook); <i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Decorador para el método Post</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Decorador para el objeto <code>body</code>. Los datos pasados para el nuevo libro se tratan en la variable <code>body</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creación de un nuevo objeto para poder tratar los datos recibidos</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Llamada al servicio de creación de libros con el libro recibido</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La figura siguiente muestra el resultado de la operación <code>POST</code> con el nuevo libro y la respuesta obtenida.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/PostBook.png" alt="PostBook.png">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueeliminaci-n-de-un-libro"><a class="anchor" href="#trueeliminaci-n-de-un-libro"></a>5.4. Eliminación de un libro</h3>
<div class="paragraph">
<p>La eliminación es muy similar a la de búsqueda de un elemento por <code>id</code>. Se intercepta el <code>id</code> de la ruta y se llama al servicio.</p>
</div>
<div class="sect3">
<h4 id="trueel-servicio-5"><a class="anchor" href="#trueel-servicio-5"></a>5.4.1. El servicio</h4>
<div class="paragraph">
<p>Añadimos la función que implementa el servicio de eliminación de un libro. Se trata de una función muy similar a la de buscar un libro. Tomará como argumento el <code>id</code> del libro e inicialmente se limitará a devolver un mensaje con el nombre de la función y el id pasado como argumento. Esto permite comprobar que la función ha sido llamada correctamente.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  deleteBook(bookId: string) {
    return `deleteBook funcionando con bookId: ${bookId}`;
  }
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-controlador-5"><a class="anchor" href="#trueel-controlador-5"></a>5.4.2. El controlador</h4>
<div class="paragraph">
<p>Añadimos la ruta que implementa la petición. Tomará como parámetro el <code>id</code> del libro (<code>bookId</code>). Usaremos el decorador NestJS <code>@Delete</code></p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
@Controller('books')
export class BooksController {
...
  @Delete(':bookId') <i class="conum" data-value="1"></i><b>(1)</b>
  deleteBook(@Param('bookId') bookId: string) { <i class="conum" data-value="2"></i><b>(2)</b>
    return this.booksService.deleteBook(bookId); <i class="conum" data-value="3"></i><b>(3)</b>
  }
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>bookId</code> es el nombre que se le da al argumento en la petición</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Método asociado a la petición con referencia al argumento de la petición y variable asociada para el método</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Llamada al método del servicio que resuelve la petición</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si ahora hacemos un <code>DELETE</code> contra <code><a href="http://localhost:3000/api/v1/books/1" class="bare">http://localhost:3000/api/v1/books/1</a></code> el controlador interceptará la petición, asignará <code>1</code> al parámetro <code>bookId</code> y obtendremos la respuesta siguiente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DeleteBookV0.png" alt="DeleteBookV0.png">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truemodificaci-n-de-un-libro"><a class="anchor" href="#truemodificaci-n-de-un-libro"></a>5.5. Modificación de un libro</h3>
<div class="paragraph">
<p>La modificación se puede ver como una operación que combina búsqueda y paso del <code>body</code> con los datos a actualizar. Se intercepta el <code>id</code> de la ruta el <code>body</code>  de la petición.</p>
</div>
<div class="sect3">
<h4 id="trueel-servicio-6"><a class="anchor" href="#trueel-servicio-6"></a>5.5.1. El servicio</h4>
<div class="paragraph">
<p>Añadimos la función que implementa el servicio de modificación de un libro. Tomará como argumentos el <code>id</code> del libro y los nuevos datos del libro. Inicialmente devolverá los datos del libro modificado. Esto permite comprobar que la función ha sido llamada correctamente.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
  updateBook(bookId: string, newBook: any) {
    return newBook;
  }
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueel-controlador-6"><a class="anchor" href="#trueel-controlador-6"></a>5.5.2. El controlador</h4>
<div class="paragraph">
<p>Añadimos la ruta que implementa la petición. Tomará como parámetro el <code>id</code> del libro (<code>bookId</code>). Usaremos el decorador NestJS <code>@Put</code></p>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
@Controller('books')
export class BooksController {
...
  @Put(':bookId') <i class="conum" data-value="1"></i><b>(1)</b>
  updateBook(@Param('bookId') bookId: string, @Body() body) { <i class="conum" data-value="2"></i><b>(2)</b>
    let newBook: any = body;
    return this.booksService.updateBook(bookId, newBook); <i class="conum" data-value="3"></i><b>(3)</b>
  }
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>bookId</code> es el nombre que se le da al argumento en la petición</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Método asociado a la petición con referencia al argumento de la petición, variables asociada para el método y cuerpo con los nuevos datos del libro</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Llamada al método del servicio que resuelve la petición</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si ahora hacemos un <code>UPDATE</code> contra <code><a href="http://localhost:3000/api/v1/books/1" class="bare">http://localhost:3000/api/v1/books/1</a></code> y le pasamos en el <code>body</code> el JSON con los nuevos datos del libro, el controlador interceptará la petición, asignará <code>1</code> al parámetro <code>bookId</code>, pasará el cuerpo, el controlador los pasará al servicio y obtendremos la respuesta siguiente con los nuevos datos del libro.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/PutBookV0.png" alt="PutBookV0.png">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truetipado-de-objetos"><a class="anchor" href="#truetipado-de-objetos"></a>6. Tipado de objetos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hasta ahora hemos tratados con el objeto libro, con el <code>body</code> de las peticiones que hacen <code>POST</code> o <code>PUT</code> y en ninguna hemos indicado un tipo de datos. Su tipo queda entonces como <code>any</code>. Sin embargo, esto no es una buena práctica. El uso de tipos nos permitirá durante el desarrollo determinar las propiedades aplicables a un objeto, la estructura que tienen que tener los objetos de las peticiones, y demás.</p>
</div>
<div class="paragraph">
<p>En este tutorial vamos a ver distintos tipos aplicables a los objetos. Para favorecer su comprensión seguimos con el ejemplo de los libros y suponemos que vamos a usar una base de datos para persistir los datos. En este caso tendríamos lo siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En la capa de base de datos los libros se podría modelar como una tabla en una base de datos relacional, como una colección en una base de datos de documentos,</p>
</li>
<li>
<p>Las <strong>entities</strong>. Si decidimos usar un <a href="https://es.wikipedia.org/wiki/Mapeo_objeto-relacional">ORM</a>, <a href="https://www.quora.com/What-is-Object-Document-Mapping">ODM</a> o similar, necesitaremos crear un objeto <code>entity</code> que represente la estructura de lo que se almacena en la base de datos. En nuestro caso, el objeto <code>entity</code> para libro podría tener las mismas propiedades que el objeto de la base de datos. Los objetos <code>entity</code> son los que se almacenan y se leen de la base de datos.</p>
</li>
<li>
<p>Las <strong>interfaces</strong>. En el nivel de desarrollo necesitamos manipular las propiedades de un objeto para no hacer referencia a propiedades inexistentes, evitar errores de tipado al trabajar con las propiedades de los objetos, y demás. Para ello, necesitaremos tener un <em>tipo</em> que represente a los objetos del negocio desde el punto de la programación. Estos tipos no tienen por que ser sustituidos por los tipos anteriores de los ORM/ODM, ya que nuestra aplicación puede que no usase ORM/ODM y no por ello dejarían de ser necesarios los tipos. Los tipos en este nivel los denominamos interfaces.</p>
</li>
<li>
<p>Los <strong>DTO (Data Transfer Objects)</strong>. Por último, hemos visto que las peticiones envían sus datos para que sean procesados por los servicios. Sin embargo, los datos enviados en las peticiones no tienen por que tener la misma estructura que las interfaces o que las <em>entities</em> definidas. Por ejemplo, en la petición para crear un libro puede que no se envíe el <code>id</code> del libro a crear porque se trata de un valor generado por el sistema. Por tanto, el tipo usado en la petición podría no coincidir con alguno de los tipos anteriores (<em>entities</em>,  DTO). Estaríamos hablando de un tipo exclusivo para la creación de libros (el tipo que contiene las propiedades que se pasan para crear un libro). Además, operaciones diferentes podrían usar tipos diferentes. Un caso sería que las modificaciones no permitiesen modificar todos los campos de un libro. Estaríamos ante un nuevo tipo, el tipo de los objetos a modificar. A este tipo de objetos se les denomina DTO. (Es habitual usar <code>CreateBookDTO</code>, <code>UpdateBookDTO</code> para representar los tipos de los datos pasados al crear y actualizar libros si los tipos son diferentes)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-una-interface-para-libros"><a class="anchor" href="#truecreaci-n-de-una-interface-para-libros"></a>6.1. Creación de una interface para libros</h3>
<div class="paragraph">
<p>Se define una interface con las propiedades que representan a un libro. En nuestro caso crearíamos un archivo <code>book.class.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">export class Book {
  id: number;
  title: string;
  genre: string;
  description: string;
  author: string;
  publisher: string;
  pages: number;
  image_url: string;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Definimos una clase en un lugar de una interface para poder instannciarla y simplificar el mockeado.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truecreaci-n-de-un-dto-para-libros"><a class="anchor" href="#truecreaci-n-de-un-dto-para-libros"></a>6.2. Creación de un DTO para libros</h3>
<div class="paragraph">
<p>Se define una clase <code>BookDto</code> que representa a las propiedades de un libro que se especifican y se envían cuando se realiza una petición para crear un libro. Hablamos de los datos que van en la petición y no tienen por que tener una correspondencia directa con un objeto completo del dominio. Incluso pueden contener propiedades de varios objetos del dominio. Como su nombre indica, los DTO (Data Transfer Object) representan a la estructura o al tipo de los datos que se están intercambiando.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">export class BookDto {
  readonly title: string;
  readonly genre: string;
  readonly description: string;
  readonly author: string;
  readonly publisher: string;
  readonly pages: number;
  readonly image_url: string;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El DTO de los libros no contiene el <code>id</code> del libro. Esto se debe a que es una propiedad que los usuarios no envían en sus peticiones.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truemodificaci-n-del-controlador-para-el-uso-de-tipos"><a class="anchor" href="#truemodificaci-n-del-controlador-para-el-uso-de-tipos"></a>6.3. Modificación del controlador para el uso de tipos</h3>
<div class="paragraph">
<p>Archivo <code>books/book.dto.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript" data-lang="typescript">...
import { BookDto } from './book.dto'; <i class="conum" data-value="1"></i><b>(1)</b>

@Controller('books')
export class BooksController {
...

  @Post()
  createBook(@Body() newBook: BookDto) { <i class="conum" data-value="2"></i><b>(2)</b>
    return this.booksService.createBook(newBook); <i class="conum" data-value="3"></i><b>(3)</b>
  }

....

  @Put(':bookId')
  updateBook(@Param('bookId') bookId: string, @Body() newBook: BookDto) { <i class="conum" data-value="4"></i><b>(4)</b>
    return this.booksService.updateBook(bookId, newBook); <i class="conum" data-value="5"></i><b>(5)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DTO de libro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Emparejamiento de lo recibido en el <code>body</code> de un <code>POST</code> al tipo <code>BookDto</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Llamada al servicio de creación de libros con el libro ya tipado</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Emparejamiento de lo recibido en el <code>body</code> de un <code>PUT</code> al tipo <code>BookDto</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Llamada al servicio de actualización de libros con el libro ya tipado</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En este ejemplo se observa que se los objetos nuevos y los objetos modificados tienen el mismo tipo. Es decir, cuando se pasa un objeto a modificar, en el <code>body</code> se pasa el libro sin <code>id</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Este tipado permite manipular de forma segura las propiedades de los libros ayudando a detectarse errores derivados de asignación de valores a tipos incorrectos.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Uno o varios DTO</div>
<div class="paragraph">
<p>Un objeto puede tener DTO diferentes para operaciones diferentes. Por ejemplo, si decidiéramos que el DTO de un libro nuevo no contuviese el <code>id</code>, pero el DTO de un libro a modificar sí lo contuviese, tendríamos un caso de DTOs diferentes (p.e. <code>CreateBook.dto.ts</code> y <code>UpdateBook.dto.ts</code>)</p>
</div>
<div class="paragraph">
<p>Archivo <code>CreateBook.dto.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">export class CreateBookDto {
  readonly title: string;
  readonly genre: string;
  readonly description: string;
  readonly author: string;
  readonly publisher: string;
  readonly pages: number;
  readonly image_url: string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Archivo <code>UpdateBook.dto.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">export class UpdateBookDto {
  readonly id: number; <i class="conum" data-value="1"></i><b>(1)</b>
  readonly title: string;
  readonly genre: string;
  readonly description: string;
  readonly author: string;
  readonly publisher: string;
  readonly pages: number;
  readonly image_url: string;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DTO de un libro para modificar que sí lleva el <code>id</code> del libro modificado</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truemodificaci-n-del-servicio-para-el-uso-de-tipos"><a class="anchor" href="#truemodificaci-n-del-servicio-para-el-uso-de-tipos"></a>6.4. Modificación del servicio para el uso de tipos</h3>
<div class="paragraph">
<p>Archivo <code>books/book.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
import { BookDto } from './book.dto'; <i class="conum" data-value="1"></i><b>(1)</b>

@Injectable()
export class BooksService {
...
  createBook(newBook: BookDto) { <i class="conum" data-value="2"></i><b>(2)</b>
    return newBook;
  }

...

  updateBook(bookId: string, newBook: BookDto) { <i class="conum" data-value="3"></i><b>(3)</b>
    return newBook;
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DTO de libro</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Libro tipado al DTO</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Libro tipado al DTO</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Este tipado permite manipular de forma segura las propiedades de los libros ayudando a detectarse errores derivados de asignación de valores a tipos incorrectos.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truefinalizaci-n-del-mockeado"><a class="anchor" href="#truefinalizaci-n-del-mockeado"></a>7. Finalización del mockeado</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hasta ahora, las únicas operaciones que estaban mockeadas con objetos del dominio eran las operaciones de creación y de modificación. Las operaciones de consulta y eliminación se limitabana a devolver un texto indicando que se había alcanzado el endpoint. En este apartado, haremos que todas las operaciones trabajen con datos del dominio aunque todavía será algo preliminar, ya que serán sólo un par de libros almacenados en el propio código y ninguna operación tratará con datos reales (p.e. la búsqueda de un libro siempre devolverá el mismo libro, la actualización/eliminación siempre informará que se ha modificado/eliminado el mismo libro). No obstante, esto permite que el controlador ya trate con los tipos de datos que devolverán los servicios cuando implementen su funcionalidad real.</p>
</div>
<div class="sect2">
<h3 id="trueel-servicio-7"><a class="anchor" href="#trueel-servicio-7"></a>7.1. El servicio</h3>
<div class="paragraph">
<p>El archivo <code>books/boo.service.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { Injectable, HttpStatus, HttpException } from '@nestjs/common';
import { BookDto } from './book.dto'; <i class="conum" data-value="1"></i><b>(1)</b>
import { Book } from './book.class'; <i class="conum" data-value="2"></i><b>(2)</b>

@Injectable()
export class BooksService {
  books: Book[] = [ <i class="conum" data-value="3"></i><b>(3)</b>
    {
      id: 1,
      title: 'Una historia de España',
      genre: 'Historia',
      description:
        'Un relato ameno, personal, a ratos irónico, pero siempre único, de nuestra accidentada historia a través de los siglos. Una obra concebida por el autor para, en palabras suyas, «divertirme, releer y disfrutar; un pretexto para mirar atrás desde los tiempos remotos hasta el presente, reflexionar un poco sobre ello y contarlo por escrito de una manera poco ortodoxa.',
      author: 'Arturo Pérez-Reverte',
      publisher: 'Alfaguara',
      pages: 256,
      image_url:
        'https://images-na.ssl-images-amazon.com/images/I/41%2B-e981m1L._SX311_BO1,204,203,200_.jpg',
    },
    {
      id: 2,
      title: 'Historia de España contada para escépticos',
      genre: 'Historia',
      description:
        'Como escribe el autor, no pretende ser veraz, justa y desapasionada, porque ninguna historia lo es. No está hecha para halagar a reyes y gobernantes, ni pretende halagar a los banqueros, ni a la Conferencia Episcopal, ni al colectivo gay.',
      author: 'Juan Eslava Galán',
      publisher: 'Booket',
      pages: 592,
      image_url:
        'https://images-na.ssl-images-amazon.com/images/I/51IyZ5Mq8YL._SX326_BO1,204,203,200_.jpg',
    },
  ];
  findAll(params): Book[] { <i class="conum" data-value="4"></i><b>(4)</b>
    return this.books;
  }

  findBook(bookId: string): Book { <i class="conum" data-value="5"></i><b>(5)</b>
    return this.books[parseInt(bookId) - 1];
  }

  createBook(newBook: BookDto): Book { <i class="conum" data-value="6"></i><b>(6)</b>
    let book = new Book();

    book.id = 99;
    book.author = newBook.author;
    book.description = newBook.description;
    book.genre = newBook.genre;
    book.image_url = newBook.image_url;
    book.pages = newBook.pages;
    book.publisher = newBook.publisher;
    book.title = newBook.title;

    return book;
  }

  deleteBook(bookId: string): Book { <i class="conum" data-value="7"></i><b>(7)</b>
    return this.books[parseInt(bookId) - 1];
  }

  updateBook(bookId: string, newBook: BookDto): Book { <i class="conum" data-value="8"></i><b>(8)</b>
    return this.books[parseInt(bookId) - 1];
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>DTO del libro (no contiene el <code>id</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Interface del libro (contiene el <code>id</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Lista de libros de ejemplo mientras se desarrolla el acceso a BD del servicio</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>El método devuelve un array de <code>Book</code> con todos los libros</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>El método devuelve un <code>Book</code>, que contiene el <code>id</code>. Devuelve un libro a modo de ejemplo</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>El método toma un <code>BookDto</code> como argumento (libro sin <code>id</code>) y devuelve un libro completo (con el <code>id</code>). Devuelve el libro insertado</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>El método devuelve un <code>Book</code>, que contiene el <code>id</code>. Devuelve un libro a eliminado modo de ejemplo</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>El método toma un <code>BookDto</code> como argumento (libro sin <code>id</code>) y devuelve un <code>Book</code>, que sí contiene el <code>id</code>. Devuelve un libro modificado a modo de ejemplo</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="trueel-controlador-7"><a class="anchor" href="#trueel-controlador-7"></a>7.2. El controlador</h3>
<div class="paragraph">
<p>Se trata de usar los tipos que usan los parámetros de las funciones en las peticiones y de los tipos que devuelven.</p>
</div>
<div class="paragraph">
<p>Archivo <code>books/books.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import {
  Controller,
  Get,
  Param,
  Req,
  Post,
  Body,
  Delete,
  Put,
} from '@nestjs/common';
import { BooksService } from './books.service';
import { Request } from 'express';
import { BookDto } from './book.dto';
import { Book } from './book.class';

export class BooksController {
  constructor(private booksService: BooksService) {}

  findAll(@Req() request: Request): Book[] {
    console.log(request.query);
    return this.booksService.findAll(request.query);
  }

  findBook(@Param('bookId') bookId: string): Book {
    return this.booksService.findBook(bookId);
  }

  createBook(@Body() newBook: BookDto): Book {
    return this.booksService.createBook(newBook);
  }

  deleteBook(@Param('bookId') bookId: string): Book {
    return this.booksService.deleteBook(bookId);
  }

  updateBook(@Param('bookId') bookId: string, @Body() newBook: BookDto): Book {
    return this.booksService.updateBook(bookId, newBook);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truedocumentaci-n-de-la-api-con-swagger-openapi"><a class="anchor" href="#truedocumentaci-n-de-la-api-con-swagger-openapi"></a>8. Documentación de la API con Swagger (OpenAPI)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NestJS cuenta con un módulo que permite la generación automática de la documentación en Swagger (OpenAPI). Esto permite obtener la documentación de la API y sus endpoints mediante decoradores en el código.</p>
</div>
<div class="paragraph">
<p>Comenzaremos instalando las dependencias de Swagger en el proyecto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ npm install --save @nestjs/swagger swagger-ui-express</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continación hay que modificar el archivo <code>main.js</code> usando la clase <code>SwaggerModule</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger'; <i class="conum" data-value="1"></i><b>(1)</b>

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.setGlobalPrefix('api/v1');

  // Configurar títulos de documnentación
  const options = new DocumentBuilder() <i class="conum" data-value="2"></i><b>(2)</b>
    .setTitle('Bookstore REST API')
    .setDescription('API REST de Bookstore')
    .setVersion('1.0')
    .build();
  const document = SwaggerModule.createDocument(app, options); <i class="conum" data-value="3"></i><b>(3)</b>

  // La ruta en que se sirve la documentación
  SwaggerModule.setup('docs', app, document); <i class="conum" data-value="4"></i><b>(4)</b>

  await app.listen(3000);
}
bootstrap();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Importaciones necesarias</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configuración de opciones generales de la documentación (título, versión, &#8230;&#8203;)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creación de la documentación con las opciones configuradas</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Especificación de la ruta relativa donde se sirve la documentación Swagger</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="truedocumentaci-n-de-los-dto"><a class="anchor" href="#truedocumentaci-n-de-los-dto"></a>8.1. Documentación de los DTO</h3>
<div class="paragraph">
<p>En la clases DTO incluiremos un decorador <code>@ApiProperty()</code> antes de cada propiedad. A este decorador se le puede pasar un ejemplo que facilite la introducción al uso de la API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El uso de decoradores en los DTO permite que aparezcan el tipo y un ejemplo definido siempre que use un DTO, lo que facilita bastante la interacción con la documentación.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { ApiProperty } from '@nestjs/swagger'; <i class="conum" data-value="1"></i><b>(1)</b>

export class BookDto {
  @ApiProperty({ example: 'Don Quijote de la Mancha' }) <i class="conum" data-value="2"></i><b>(2)</b>
  readonly title: string;

  @ApiProperty({ example: 'Novela' })
  readonly genre: string;

  @ApiProperty({
    example: 'Esta edición del Ingenioso hidalgo don Quijote de la Mancha ...',
  })
  readonly description: string;

  @ApiProperty({ example: 'Miguel de Cervantes' })
  readonly author: string;

  @ApiProperty({ example: 'Santillana' })
  readonly publisher: string;

  @ApiProperty({ example: 592 })
  readonly pages: number;

  @ApiProperty({ example: 'www.imagen.com/quijote.png' })
  readonly image_url: string;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Importación de decoradores</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configuración de propiedades</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>También hay que incluir decoradores <code>@ApiProperty</code> en interfaces y otras clases definidas para tipado.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Archivo <code>books/book.class.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">import { ApiProperty } from '@nestjs/swagger';
export class Book {
  @ApiProperty({ example: 99 }) <i class="conum" data-value="1"></i><b>(1)</b>
  id: number;

  @ApiProperty({ example: 'Don Quijote de la Mancha' })
  title: string;

  @ApiProperty({ example: 'Novela' })
  genre: string;

  @ApiProperty({
    example: 'Esta edición del Ingenioso hidalgo don Quijote de la Mancha ...',
  })
  description: string;

  @ApiProperty({ example: 'Miguel de Cervantes' })
  author: string;

  @ApiProperty({ example: 'Santillana' })
  publisher: string;

  @ApiProperty({ example: 592 })
  pages: number;

  @ApiProperty({ example: 'www.imagen.com/quijote.png' })
  image_url: string;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Que también se muestre el id en los ejemplos de libros completos</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truedocumentaci-n-de-los-controladores"><a class="anchor" href="#truedocumentaci-n-de-los-controladores"></a>8.2. Documentación de los controladores</h3>
<div class="paragraph">
<p>Los métodos de los controladores se pueden agrupar mediante etiquetas Swagger. Para ello se usa el decorador <code>@ApiTags()</code>. Se puede usar el decorador a nivel de clase, lo que combinará a todos los métodos en el mismo grupo. También se puede usar a nivel de método.</p>
</div>
<div class="paragraph">
<p>En cada operación se incluirá:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un decorador <code>@ApiOperation()</code> para proporcionar una descripción para la operación</p>
</li>
<li>
<p>Un decorador <code>@ApiResponse()</code> por cada respuesta que proporcione la operación (p.e. 200, 403, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A continuación se muestra un fragmento de la anotación en <code>books/books.controller.ts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">...
import { BookDto } from './book.dto';
import { ApiOperation, ApiResponse, ApiTags } from '@nestjs/swagger';
...
@ApiTags('book') <i class="conum" data-value="1"></i><b>(1)</b>
@Controller('books')
export class BooksController {

  @Post()
  @ApiOperation({ summary: 'Crear un libro' }) <i class="conum" data-value="2"></i><b>(2)</b>
  @ApiResponse({ <i class="conum" data-value="3"></i><b>(3)</b>
    status: 201,
    description: 'Datos del libro creado',
    type: Book, <i class="conum" data-value="4"></i><b>(4)</b>
  })
  @ApiResponse({ status: 403, description: 'Forbidden.' }) <i class="conum" data-value="5"></i><b>(5)</b>
  createBook(@Body() newBook: BookDto) {
    return this.booksService.createBook(newBook);
  }
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Especificación de la etiqueta para combinar a todos las operaciones de este controlador en el grupo <code>book</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Descripción de la operación</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Respuesta 201</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Al especificar el tipo, se puede ver un ejemplo de la respuesta en la documentación</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Respuesta 403</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La figura siguiente muestra cómo quedaría la documentación servida el la ruta <code>docs</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Swagger.png" alt="Swagger.png">
</div>
</div>
<div class="paragraph">
<p>Para más información sobre Swagger, consultar la  <a href="https://docs.nestjs.com/recipes/swagger">documentación oficial</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truedocumentaci-n-del-c-digo"><a class="anchor" href="#truedocumentaci-n-del-c-digo"></a>9. Documentación del código</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NestJS usa <a href="https://compodoc.app/">Compodoc</a>, una herramienta de documentación para Angular. Al documentar el código los miembros del equipo de desarrollo podrán entender fácilmente las características de la aplicación o librería. La documentación se anota mediante <a href="https://jsdoc.app/">JSDoc</a> siguiendo este esquema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts" data-lang="ts">/**
 * Supported comment
 */</code></pre>
</div>
</div>
<div class="paragraph">
<p>Entre los tags JSDoc, destacan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@returns {Type} Description</code></p>
</li>
<li>
<p><code>@param {Type} Name Description</code></p>
</li>
<li>
<p><code>@ignore</code> para excluir un fragmento de código de la documentación</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para instalar Compodoc en un proyecto NestJS basta con añadir la dependencia:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ npm i -D @compodoc/compodoc</code></pre>
</div>
</div>
<div class="paragraph">
<p>La documentación se generará desde la línea de comandos mediante <code>npx</code> (una herramienta para ejecutar paquetes de Node disponible con <code>npm 6</code>). Esto generará una carpeta <code>documentation</code> en el proyecto que se podrá servir con el proyecto o en un portal de ámbito más global donde estén todas las documentaciones de los proyectos desarrollados por el equipo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ npx compodoc -p tsconfig.json -s --theme material</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El parámetro <code>-s</code> inicia un servidor en el puerto 8080 para poder consultar la documentación. El parámetro <code>--theme material</code> aplica el tema <code>material</code> a la documentación. Para más información sobre las opciones de uso, consultar la <a href="https://compodoc.app/guides/options.html">documentación oficial</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Compodoc genera una página <code>Overview</code> donde presenta un diagrama con los disntintos componentes y sus relaciones, algo muy interesante para hacerse una primera idea de la composición e interacción del software desarrollado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Compodoc-Overview.png" alt="Compodoc Overview.png">
</div>
</div>
<div class="paragraph">
<p>La figura siguiente ilustra el formato de la documentación de un componente de la aplicación.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Compodoc-Documentacion.png" alt="Compodoc Documentacion.png">
</div>
</div>
<div class="paragraph">
<p>Para más información sobre JSDoc, consultar la <a href="https://compodoc.app/">documentación oficial</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-07-31 08:16:55 CEST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>